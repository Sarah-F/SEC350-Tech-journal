Lab 1.1 - Routing and DMZ
Firewall (VYOS) Tech Journal

Set up
    Log inot rw01
    Click whale, select settings, select advanced network configurations, double click wired connection 1, select 1Pv4, select manual as the method, click add
      Address: 10.0.17.17
      Netmask: 24
      Gateway: 10.0.17.2
      DNS: 10.0.17.2
      Click save
    Click whale, select terminal emulator, Add a sudo user using the following commands
      #sudo -i (to log in to sudo user)
      #adduser sarah
      #Y
      #usermod -aG sudo sarah
      #hostnamectl set-hostname rw01-sarah
      #reboot
  
Deliverable 1:
Click whale, click internet, open chrome, type in champlain.edu

Configuring basic routing on fw01
    Go to the vsphere tab where you can see all your VMS
    Click the drop down menu of VM Hardware
    Click Edit settings 
    Change network adapter 2 to DMZ
    Add new device, select network adapter, select LAN
  Configure, Commit, Save and Exit â€¦ Learn this!
    Open fw01 and log In
  Setting the Hostname (type in the following commands)
    #configure
    #set sytem host-name fw1-sarah
    #commit
    #save
    #exit
    #exit
    when you log back in (and at the log in, you should see your new hostname)

  Interface Assignment
    #show interfaces
  Set interface descriptions
    #configure
    #delete interfaces ethernet eth0 address dhcp (only do this if there is dhcp shown in the interaces))
    #set interfaces ethernet eth0 description SEC350-WAN
    #set interfaces ethernet eth1 description SARAH-DMZ
    #set interfaces ethernet eth2 description SARAH-LAN
    #commit
    #save
    #show interfaces
    #exit
 Set eth0,1,&2 adresses   
    #configure
    set interfaces ethernet ethX address [address]/[netmask] (format, not code)
    #set interfaces ethernet eth0 address 10.0.17.117/24
    #set interfaces ethernet eth1 address 172.16.50.2/29
    #set interfaces ethernet eth2 address 172.16.150.2/24
    #commit
    #save
    #show interfaces
  Set default gateway and DNS server to SEC-350-Gateway Firewall (10.0.17.2), points WAN interface to the internet
    #configure
    #set protocols static route 0.0.0.0/0 next-hop 10.0.17.2
    #set system name-server 10.0.17.2
    #commit
    #save

Deliverable 2: ping coogle
#ping -c1 google.com

Configuring web01
  Go to the web01 vm
  Click Edit settings 
  Change network adapter 1 to DMZ
  Set hostname:
  #hostnamectl set-hostname web01-sarah (this can also be done within NMTUI)
  #nmtui
    select edit a connection
    select ens192
    change ipv4 setting from automatic to manual
    click show
    Address = web01 DMZ address (172.16.50.3/29)
    Gateway and DNS = DMZ interface on fw01 (172.16.50.2) for devices within the DMZ
    click ok
    click back
    click ok
 Create a sudo user
    #useradd sarah
    #passwd sarah
    create new password = password
    #usermod -aG wheel sarah

  #ping -c1 172.16.50.2 (to see if shit works)
  #ping -c1 8.8.8.8 (to see if shit works)
  #exit
  log into new user (sarah)

Configuring fw01 for NAT and DNS Forwarding on fw01.
  Go back to fw01 machine
  #configure
  #set nat source rule 10 description "NAT FROM DMZ to WAN"
  #set nat source rule 10 outbound-interface eth0
  #set nat source rule 10 source address 172.16.50.0/29
  #set nat source rule 10 translation address masquerade
  #commit
  #save
  #show nat source rule 10

Deliverable 3
On web01, you should now be able to ping by IP address, but not hostname yet:
Deliverable 3:  Provide a screenshot of a successful ping from web01 to 8.8.8.8 followed by a failed DNS lookup for google.com
  Go back to web01 vm
  #ping -c2 8.8.8.8
  #ping -c2 google.com

Configuring fw01 for DNS forwarding
go back to fw01 vm
  #set service dns forwarding listen-address 172.16.50.2
  #set service dns forwarding allow-from 172.16.50.0/29
  #set service dns forwarding system
  #commit
  #save
  
Deliverable 4:
You should now be able to ping resolve DNS
Deliverable 4:  Submit a successful ping to google.com from web01, and make sure your hostname is correct as well.
  #ping -c1 google.com

Configuring log01
  Go to the log01 vm
  Click Edit settings 
  Change network adapter 1 to DMZ
  launch vm
  #hostnamectl set-hostname log01-sarah
  #exit
  relogin
  #nmtui
    #nmtui
    select edit a connection
    select ens192
    change ipv4 setting from automatic to manual
    click show
    IPv4Address: 172.16.50.5/29
    Gateway and DNS = 172.16.50.2
    click ok
    click back
    click ok
  Create a sudo user
    #useradd sarah
    #passwd sarah
    create new password = password
    #usermod -aG wheel sarah
 
Deliverable 5. on log01
#ifconfig
#ping -c1 google.com


Configuring httpd on web01
go back to web01 vm
  #sudo yum install httpd -y
  #systemctl start httpd
  #sudo systemctl status httpd
On web01, ensure that var/www/html/index.html exists.
 #cd /var/www/html
 #ls
 #sudo nano index.html
 <html>hi</html>
 control x, hit y
 #ls
 make sure that index.html can be seen
 #cd
 
Configuring firewall on web01
  #sudo firewall-cmd --state
  #sudo firewall-cmd --list-all
  #sudo firewall-cmd --zone=public --add-port=443/tcp --permanent
  #sudo firewall-cmd --zone=public --add-port=80/tcp --permanent
  #sudo firewall-cmd --reload

Testing httpd on web01 from rw01
 Open rw01
 Click on the whale,
    select settings, 
    select advanced network configurations, 
    double click wired connection 1, 
    select 1Pv4 settings,
    select routes
      Address: 172.16.50.0
      Netmask: 29
      Gateway: 10.0.17.117
    click save (make sure to do this)

Make sure to restart your network through the gui or from a privileged terminal command.
#sudo nmcli networking off
#sudo nmcli networking on

syslog Tech Journal
Configuring rsyslog services on log01
go to log01
    #sudo firewall-cmd --list-all
    #firewall-cmd --zone=public --add-port=514/tcp --permanent
    #firewall-cmd --zone=public --add-port=514/udp --permanent
    #firewall-cmd --reload
  On log01, the /etc/rsyslog.conf file needs to be modified to receive syslog messages over ports 514 tcp and udp.  Uncomment the appropriate lines (see below) and restart the rsyslog service.
    #cd /etc/
    #sudo nano rsyslog.conf
    uncomment the stuff under lines "# provides udp syslog reception" and "# provides tcp syslog reception"
    comment out six lines total
    control x, hit y
    #sudo systemctl restart rsyslog
-needed to make sarah a sudo user, had to go back to root and do #sudo usermod -aG wheel sarah
    You can check to see if rsyslog is listening appropriately to these ports
    #sudo netstat -tupan | grep 514

Configuring rsyslog client on web01
    go back to web01
    create the file /etc/rsyslog.d/sec350.conf on web01
    #cd /etc/rsyslog.d
    #sudo nano sec350.conf
    type the following in this file:
    #user.notice @172.16.50.5
            the line in sec350.conf means:
            user=syslog facility
            notice=syslog priority
            @=UDP, @@ means TCP, so we are only going to send UDP
            172.16.50.5=Remote Syslog Server
   
Test rsyslog messaging from web01 to log01
On web01
#sudo systemctl restart rsyslog
#logger -t test TESTFROMWEB01TOLOG01
On log01 
#sudo tail /var/log/messages

rw01->SSH->web01->SSH->log01
From rw01, use a SSH session to login to web01, from that SSH session login to log01.
go to rw01 and open terminal
#ssh sarah@172.16.50.3
#ssh sarah@172.16.50.5
